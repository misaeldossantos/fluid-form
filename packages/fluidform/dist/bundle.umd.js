!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("./node_modules/mobx-react-lite/es/index.js"),require("../../node_modules/react/index.js"),require("lodash"),require("./node_modules/mobx-react/dist/mobxreact.esm.js"),require("./node_modules/mobx/dist/mobx.esm.js")):"function"==typeof define&&define.amd?define(["exports","./node_modules/mobx-react-lite/es/index","../../node_modules/react/index","lodash","./node_modules/mobx-react/dist/mobxreact.esm","./node_modules/mobx/dist/mobx.esm"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["@fluidform/core"]={},e.index_js,e.React,e.lodash,e.mobxreact_esm_js,e.mobx_esm_js)}(this,(function(e,t,s,a,r,o){"use strict";function n(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var l=n(s),i=s.createContext(null);var u=t.observer((function({children:e,validateOnBlur:t,form:a}){if(!a)return e;const{errors:r,values:o}=a,n=s.useCallback((e=>{t&&a.validatePath(e)}),[t]);return l.default.createElement(i.Provider,{value:{values:o,onBlur:n,errors:r,form:a}},e)})),d=s.createContext({components:{form:{}}});function c(...e){return function(...t){for(let s of e)s&&s(...t)}}const m={asChange:{alias:"onChange",apply:e=>e},asValue:"value",asOnBlur:{alias:"onBlur"}};var f=r.observer((({path:e,use:t,children:r,onChange:n,displayValue:u,defaultValue:f,...h})=>{const{values:v,errors:p,onBlur:b}=s.useContext(i),x=function(e){const t=s.useContext(d);return s.useMemo((()=>t.components[e]),[e,t])}("form"),{...g}=l.default.useMemo((()=>x[t]||h),[x,t]),{asValue:y=m.asValue,asChange:_=[],asOnBlur:C=m.asOnBlur.alias}=g,[V=m.asChange.alias]=_,j=l.default.useMemo((()=>_[1]?"function"==typeof _[1]?_[1]:"string"==typeof _[1]?e=>a.get(e,_[1]):void 0:m.asChange.apply),[_]);function P(){const t=a.get(v,e);return u?u(t):t}const B=l.default.useCallback((()=>P()||f||function(e=String){switch(e){case String:return"";case Number:return 0;case Boolean:return!1}}(g.type)),[g.type]),[E,O]=s.useState(B);s.useEffect((()=>o.reaction((()=>a.get(v,e)),(()=>{O(P())}))),[]);const q={[y]:E,[V]:c(((...t)=>a.set(v,e,j(...t))),n),[C]:()=>b(e),error:a.get(p,e)},w=l.default.Children.only(r);return l.default.cloneElement(w,{key:e,...q},w.props.children)}));class h{constructor({initialValues:e,validator:t}){this.errors={},this.values={},this.values=e||{},this.validator=t,o.makeAutoObservable(this)}async validateAll(){o.set(this.errors,await this.validator(this.values))}get isValid(){if(!this.validator)return!1;const e=this.validator(this.values);return a.isEmpty(e)}async validatePath(e){this.setPathError(e,await this.validator(this.values,e))}setPathError(e,t){a.set(this.errors,e,t)}setValues(e){this.values=a.merge(o.toJS(this.values),e)}setPathValue(e,t){o.set(this.values,e,t)}get raw(){return o.toJS(this.values)}}e.Field=f,e.Form=u,e.FormProvider=({components:e,children:t})=>l.default.createElement(d.Provider,{value:{components:e}},t),e.useForm=function({initialValues:e,validator:t}={}){return s.useMemo((()=>new h({initialValues:e,validator:t})),[t])},Object.defineProperty(e,"__esModule",{value:!0})}));
